<!DOCTYPE html>
<html lang="fr">
<head>
    <script>
  // Mot de passe admin simple (√† remplacer par un vrai syst√®me s√©curis√© c√¥t√© serveur)
  const ADMIN_PASSWORD = "1234";

  // Fonction de demande du mot de passe admin
  function askAdminPassword() {
    const pwd = prompt("Veuillez entrer le mot de passe administrateur :");
    if (pwd !== ADMIN_PASSWORD) {
      alert("Mot de passe incorrect. Acc√®s refus√©.");
      // Bloquer l'acc√®s en cachant tout ou redirigeant
      document.body.innerHTML = "<h2>Acc√®s refus√©</h2>";
      throw new Error("Acc√®s refus√© : mot de passe incorrect");
    }
  }

  // Appeler cette fonction d√®s que possible
  askAdminPassword();
</script>

<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gestion Financi√®re  </title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
    
  th {
    cursor: pointer;
  }
  th.sort-asc::after {
    content: " ‚ñ≤";
  }
  th.sort-desc::after {
    content: " ‚ñº";
  }
</style>
</head>
<body>


<body class="bg-gray-50 p-4 min-h-screen flex flex-col">
  <h1 class="text-4xl font-bold mb-6 text-center text-indigo-700">üíº Logiciel de Gestion By khalil Chifai-Tech</h1>

  <form id="transactionForm" class="bg-white rounded shadow-md p-5 mb-6 max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-6 gap-4 items-end">
    <input type="hidden" id="editIndex" value="" />
    <div>
      <label for="date" class="block mb-1 font-semibold text-gray-700">Date</label>
      <input type="date" id="date" class="border border-gray-300 rounded w-full p-2" required />
    </div>
    <div>
      <label for="description" class="block mb-1 font-semibold text-gray-700">Description</label>
      <input type="text" id="description" placeholder="Ex: Frais de scolarit√©" class="border border-gray-300 rounded w-full p-2" required />
    </div>
    <div>
      <label for="amount" class="block mb-1 font-semibold text-gray-700">Montant (F CFA)</label>
      <input type="number" step="0.01" id="amount" placeholder="Ex: 15000" class="border border-gray-300 rounded w-full p-2" required />
    </div>
    <div>
      <label for="type" class="block mb-1 font-semibold text-gray-700">Type</label>
      <select id="type" class="border border-gray-300 rounded w-full p-2">
        <option value="recette">Recette</option>
        <option value="d√©pense">D√©pense</option>
      </select>
    </div>
    <div>
      <label for="category" class="block mb-1 font-semibold text-gray-700">Cat√©gorie</label>
      <select id="category" class="border border-gray-300 rounded w-full p-2">
        <option value="Frais d'inscription">Frais d'inscription</option>
        <option value="Fournitures">Fournitures</option>
        <option value="Salaires">Salaires</option>
        <option value="Maintenance">Maintenance</option>
        <option value="Divers">Divers</option>
      </select>
    </div>
    <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white rounded px-4 py-2 font-bold transition" id="submitBtn">Ajouter</button>
    <button type="button" id="cancelEditBtn" class="bg-gray-400 hover:bg-gray-500 text-white rounded px-4 py-2 font-bold transition hidden">Annuler</button>
  </form>

  <section class="max-w-5xl mx-auto mb-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <div class="flex gap-2 flex-wrap">
      <select id="filterYear" class="border border-gray-300 rounded p-2">
        <option value="">Toutes les ann√©es</option>
      </select>
      <select id="filterMonth" class="border border-gray-300 rounded p-2">
        <option value="">Tous les mois</option>
        <option value="01">Janvier</option>
        <option value="02">F√©vrier</option>
        <option value="03">Mars</option>
        <option value="04">Avril</option>
        <option value="05">Mai</option>
        <option value="06">Juin</option>
        <option value="07">Juillet</option>
        <option value="08">Ao√ªt</option>
        <option value="09">Septembre</option>
        <option value="10">Octobre</option>
        <option value="11">Novembre</option>
        <option value="12">D√©cembre</option>
      </select>
      <input type="text" id="search" placeholder="Recherche description..." class="border border-gray-300 rounded p-2" />
    </div>
    <div class="flex gap-2 flex-wrap">
      <button id="exportCSVBtn" class="bg-yellow-500 hover:bg-yellow-600 text-white rounded px-4 py-2 font-semibold transition">üìÇ Export CSV</button>
      <button id="exportPDFBtn" class="bg-purple-600 hover:bg-purple-700 text-white rounded px-4 py-2 font-semibold transition">üìÑ Export PDF</button>
    </div>
  </section>

  <section class="max-w-5xl mx-auto overflow-x-auto mb-8">
    <table class="min-w-full bg-white rounded shadow" id="transactionTable">
      <thead class="bg-indigo-100 text-indigo-900">
        <tr>
          <th data-key="date" class="p-3 text-left">Date</th>
          <th data-key="description" class="p-3 text-left">Description</th>
          <th data-key="amount" class="p-3 text-right">Montant</th>
          <th data-key="type" class="p-3 text-left">Type</th>
          <th data-key="category" class="p-3 text-left">Cat√©gorie</th>
          <th class="p-3 text-center">Actions</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </section>

  <section class="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8">
    <div class="bg-white p-4 rounded shadow">
      <h2 class="text-2xl font-bold mb-4 text-indigo-700">üìà √âvolution Recettes/D√©penses/Solde (mois)</h2>
      <canvas id="comboChart" height="180"></canvas>
    </div>
    <div class="bg-white p-4 rounded shadow">
      <h2 class="text-2xl font-bold mb-4 text-indigo-700">üìä R√©partition par Cat√©gorie</h2>
      <canvas id="pieChart" height="180"></canvas>
    </div>
  </section>

<script>
    
  let transactions = JSON.parse(localStorage.getItem('transactions_superpro')) || [];
  let sortKey = null;
  let sortOrder = 'asc';
  const tbody = document.querySelector('#transactionTable tbody');
  const filterYear = document.getElementById('filterYear');
  const filterMonth = document.getElementById('filterMonth');
  const searchInput = document.getElementById('search');
  const comboCtx = document.getElementById('comboChart').getContext('2d');
  const pieCtx = document.getElementById('pieChart').getContext('2d');
  let comboChart, pieChart;

  const form = document.getElementById('transactionForm');
  const editIndexInput = document.getElementById('editIndex');
  const submitBtn = document.getElementById('submitBtn');
  const cancelEditBtn = document.getElementById('cancelEditBtn');

  function formatCFA(amount) {
    return amount.toLocaleString('fr-FR') + ' F CFA';
  }
  function saveTransactions() {
    localStorage.setItem('transactions_superpro', JSON.stringify(transactions));
  }
  function populateYearFilter() {
    const years = [...new Set(transactions.map(t => t.date.slice(0,4)))].sort();
    filterYear.innerHTML = '<option value="">Toutes les ann√©es</option>';
    years.forEach(y => {
      filterYear.innerHTML += `<option value="${y}">${y}</option>`;
    });
  }
  function getFilteredTransactions() {
    const year = filterYear.value;
    const month = filterMonth.value;
    const search = searchInput.value.trim().toLowerCase();

    return transactions.filter(t => {
      const matchesYear = !year || t.date.startsWith(year);
      const matchesMonth = !month || t.date.slice(5,7) === month;
      const matchesSearch = !search || t.description.toLowerCase().includes(search);
      return matchesYear && matchesMonth && matchesSearch;
    });
  }
  function sortTransactions(data) {
    if (!sortKey) return data;
    return data.slice().sort((a,b) => {
      let vA = a[sortKey], vB = b[sortKey];
      if (sortKey === 'amount') {
        vA = parseFloat(vA);
        vB = parseFloat(vB);
      } else if (sortKey === 'date') {
        vA = new Date(vA);
        vB = new Date(vB);
      } else {
        vA = vA.toLowerCase();
        vB = vB.toLowerCase();
      }
      if (vA < vB) return sortOrder === 'asc' ? -1 : 1;
      if (vA > vB) return sortOrder === 'asc' ? 1 : -1;
      return 0;
    });
  }
  function renderTable() {
    let data = getFilteredTransactions();
    data = sortTransactions(data);
    tbody.innerHTML = '';
    data.forEach((t, index) => {
      const tr = document.createElement('tr');
      tr.classList.add('border-b', 'hover:bg-indigo-50');

      tr.innerHTML = `
        <td class="p-3">${t.date}</td>
        <td class="p-3">${t.description}</td>
        <td class="p-3 text-right font-mono">${formatCFA(t.amount)}</td>
        <td class="p-3">${t.type}</td>
        <td class="p-3">${t.category}</td>
        <td class="p-3 text-center space-x-2">
          <button class="printBtn bg-green-500 hover:bg-green-600 text-white rounded px-2 py-1 text-xs font-semibold" data-index="${index}">üñ®Ô∏è Imprimer</button>
          <button class="editBtn bg-blue-600 hover:bg-blue-700 text-white rounded px-2 py-1 text-xs font-semibold" data-index="${index}">‚úèÔ∏è Modifier</button>
          <button class="deleteBtn bg-red-600 hover:bg-red-700 text-white rounded px-2 py-1 text-xs font-semibold" data-index="${index}">üóëÔ∏è Supprimer</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
    attachActionListeners();
    updateCharts();
  }
  function attachActionListeners() {
    document.querySelectorAll('.printBtn').forEach(btn => {
      btn.onclick = () => {
        const idx = btn.getAttribute('data-index');
        printTransaction(idx);
      };
    });
    document.querySelectorAll('.editBtn').forEach(btn => {
      btn.onclick = () => {
        const idx = btn.getAttribute('data-index');
        startEditTransaction(idx);
      };
    });
    document.querySelectorAll('.deleteBtn').forEach(btn => {
      btn.onclick = () => {
        const idx = btn.getAttribute('data-index');
        deleteTransaction(idx);
      };
    });
  }
function printTransaction(index) {
  const t = getFilteredTransactions()[index];
  if (!t) return;
  const printWindow = window.open('', '', 'width=400,height=600');
  printWindow.document.write(`
    <html lang="fr">
    <head>
      <title>Re√ßu de transaction</title>
      <style>
        body { font-family: Arial, sans-serif; padding: 20px; color: #1e293b; }
        h2 { text-align: center; color: #4f46e5; }
        .school-info { text-align: center; margin-bottom: 20px; }
        .school-info h3 { margin: 0; font-size: 1.2em; }
        .school-info p { margin: 2px 0; font-size: 0.9em; color: #475569; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #cbd5e1; padding: 8px 12px; text-align: left; }
        th { background-color: #e0e7ff; }
        td.amount { text-align: right; font-family: monospace; }
      </style>
    </head>
    <body>
      <div>
               
      <h2>Re√ßu de transaction</h2>
      <table>
        <tbody>
          <tr><th>Date</th><td>${t.date}</td></tr>
          <tr><th>Description</th><td>${t.description}</td></tr>
          <tr><th>Montant</th><td class="amount">${formatCFA(t.amount)}</td></tr>
          <tr><th>Type</th><td>${t.type}</td></tr>
          <tr><th>Cat√©gorie</th><td>${t.category}</td></tr>
        </tbody>
      </table>
    </body>
    </html>
  `);
  printWindow.document.close();
  printWindow.focus();
  printWindow.print();
}

  
  function startEditTransaction(index) {
    const t = getFilteredTransactions()[index];
    if (!t) return alert("Transaction non trouv√©e.");

    const globalIndex = transactions.findIndex(tr => tr === t);
    if (globalIndex === -1) return alert("Erreur interne.");

    editIndexInput.value = globalIndex;
    form.date.value = t.date;
    form.description.value = t.description;
    form.amount.value = t.amount;
    form.type.value = t.type;
    form.category.value = t.category;

    submitBtn.textContent = 'Enregistrer';
    cancelEditBtn.classList.remove('hidden');
  }

  function cancelEdit() {
    editIndexInput.value = '';
    form.reset();
    submitBtn.textContent = 'Ajouter';
    cancelEditBtn.classList.add('hidden');
  }

  function deleteTransaction(index) {
    const t = getFilteredTransactions()[index];
    if (!t) return alert("Transaction non trouv√©e.");
    if (confirm(`Confirmez-vous la suppression de la transaction : "${t.description}" du ${t.date} ?`)) {
      const globalIndex = transactions.findIndex(tr => tr === t);
      if (globalIndex !== -1) {
        transactions.splice(globalIndex, 1);
        saveTransactions();
        renderTable();
        populateYearFilter();
        alert("Transaction supprim√©e.");
        cancelEdit();
      } else {
        alert("Erreur interne lors de la suppression.");
      }
    }
  }

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    const date = form.date.value;
    const description = form.description.value.trim();
    const amount = parseFloat(form.amount.value);
    const type = form.type.value;
    const category = form.category.value;

    if (!date || !description || isNaN(amount)) {
      alert('Veuillez remplir tous les champs correctement.');
      return;
    }

    const editIdx = editIndexInput.value;

    if (editIdx) {
      transactions[editIdx] = { date, description, amount, type, category };
      alert('Transaction modifi√©e avec succ√®s.');
    } else {
      transactions.push({ date, description, amount, type, category });
      alert('Transaction ajout√©e avec succ√®s.');
    }

    saveTransactions();
    cancelEdit();
    populateYearFilter();
    renderTable();
  });

  cancelEditBtn.addEventListener('click', cancelEdit);

  document.querySelectorAll('th[data-key]').forEach(th => {
    th.addEventListener('click', () => {
      const key = th.getAttribute('data-key');
      if (sortKey === key) {
        sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
      } else {
        sortKey = key;
        sortOrder = 'asc';
      }
      document.querySelectorAll('th').forEach(h => h.classList.remove('sort-asc', 'sort-desc'));
      th.classList.add(sortOrder === 'asc' ? 'sort-asc' : 'sort-desc');
      renderTable();
    });
  });

  [filterYear, filterMonth, searchInput].forEach(el => {
    el.addEventListener('input', renderTable);
  });

  function updateCharts() {
    const data = getFilteredTransactions();

    const months = ['01','02','03','04','05','06','07','08','09','10','11','12'];
    const labels = months.map(m => {
      const d = new Date();
      d.setMonth(parseInt(m)-1);
      return d.toLocaleString('fr-FR', { month: 'short' });
    });

    const recettes = months.map(() => 0);
    const depenses = months.map(() => 0);

    data.forEach(t => {
      if (!t.date) return;
      const m = t.date.slice(5,7);
      const idx = months.indexOf(m);
      if (idx !== -1) {
        if (t.type === 'recette') recettes[idx] += t.amount;
        else depenses[idx] += t.amount;
      }
    });

    const solde = recettes.map((r,i) => r - depenses[i]);

    if (comboChart) comboChart.destroy();
    comboChart = new Chart(comboCtx, {
      type: 'bar',
      data: {
        labels,
        datasets: [
          { label: 'Recettes', data: recettes, backgroundColor: 'rgba(34,197,94,0.7)' },
          { label: 'D√©penses', data: depenses, backgroundColor: 'rgba(239,68,68,0.7)' },
          { label: 'Solde', data: solde, type: 'line', borderColor: '#2563eb', fill: false, tension: 0.3, yAxisID: 'y1' },
        ]
      },
      options: {
        responsive: true,
        interaction: { mode: 'index', intersect: false },
        scales: {
          y: { beginAtZero: true, position: 'left' },
          y1: { beginAtZero: true, position: 'right', grid: { drawOnChartArea: false } }
        }
      }
    });

    const categories = {};
    data.forEach(t => {
      categories[t.category] = (categories[t.category] || 0) + t.amount;
    });

    if (pieChart) pieChart.destroy();
    pieChart = new Chart(pieCtx, {
      type: 'doughnut',
      data: {
        labels: Object.keys(categories),
        datasets: [{
          data: Object.values(categories),
          backgroundColor: [
            '#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6'
          ],
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'right' }
        }
      }
    });
  }

  function exportCSV() {
    const filtered = getFilteredTransactions();
    if (filtered.length === 0) {
      alert("Aucune donn√©e √† exporter.");
      return;
    }
    const header = ['Date', 'Description', 'Montant (F CFA)', 'Type', 'Cat√©gorie'];
    const rows = filtered.map(t => [
      t.date,
      `"${t.description.replace(/"/g, '""')}"`,
      t.amount.toFixed(2),
      t.type,
      t.category
    ]);
    let csvContent = "data:text/csv;charset=utf-8," + [header, ...rows].map(e => e.join(',')).join('\n');
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement('a');
    link.setAttribute('href', encodedUri);
    const d = new Date();
    link.setAttribute('download', `transactions_${d.toISOString().slice(0,10)}.csv`);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  async function exportPDF() {
    const filtered = getFilteredTransactions();
    if (filtered.length === 0) {
      alert("Aucune donn√©e √† exporter.");
      return;
    }
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.setFontSize(18);
    doc.text("Bilan financier annuel - √âcole", 14, 20);

    doc.setFontSize(12);
    const headers = [["Date", "Description", "Montant (F CFA)", "Type", "Cat√©gorie"]];
    const data = filtered.map(t => [t.date, t.description, formatCFA(t.amount), t.type, t.category]);

    let startY = 30;
    data.forEach((row, i) => {
      if (startY > 280) {
        doc.addPage();
        startY = 20;
      }
      row.forEach((cell, idx) => {
        doc.text(String(cell), 14 + idx * 40, startY);
      });
      startY += 10;
    });

    doc.save("bilan_financier.pdf");
  }

  document.getElementById('exportCSVBtn').addEventListener('click', exportCSV);
  document.getElementById('exportPDFBtn').addEventListener('click', exportPDF);

  populateYearFilter();
  renderTable();
</script>
<!-- Footer avec texte d√©filant gauche -> droite -->
<footer class="site-footer">
  <div class="ticker" aria-hidden="false" role="status" aria-live="polite">
    <div class="ticker__move">
      <span class="ticker__text">By Khalil Sarr Chifai-Tech Tel : 77 821 28 21</span>
    </div>
  </div>
</footer>

<style>
/* style basique du footer */
.site-footer {
  background: #0b1220;
  color: #fff;
  padding: 12px 16px;
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 1000;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}

/* zone masqu√©e avec overflow pour que le texte entre/sorte proprement */
.ticker {
  overflow: hidden;
  white-space: nowrap;
  position: relative;
  width: 100%;
}

/* conteneur anim√© (on translate whole element) */
.ticker__move {
  display: inline-block;
  will-change: transform;
  /* ajustez la dur√©e selon la longueur et la vitesse souhait√©e */
  animation: slide-rtl 12s linear infinite;
  /* pause au survol */
}
.ticker__move:hover { animation-play-state: paused; }

/* le texte (dupliquez le contenu si vous voulez un d√©filement continu plus fluide) */
.ticker__text {
  display: inline-block;
  padding-right: 2rem; /* espacement entre r√©p√©titions */
  font-weight: 600;
  letter-spacing: .4px;
  font-size: 0.95rem;
}

/* Keyframes : part de -100% (compl√®tement √† gauche) -> +100% (compl√®tement √† droite) */
@keyframes slide-rtl {
  0%   { transform: translateX(-100%); }
  100% { transform: translateX(100%);  }
}

/* Respecter la pr√©f√©rence de l'utilisateur pour r√©duire les animations */
@media (prefers-reduced-motion: reduce) {
  .ticker__move { animation: none; transform: none; }
}

/* Responsive : l√©g√®rement r√©duire la taille sur petits √©crans */
@media (max-width: 420px) {
  .ticker__text { font-size: 0.9rem; }
}
</style>
<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Notre Entreprise Informatique CHIFAI - TECH</title>
<style>
  body{
    font-family: Arial, sans-serif;
    line-height: 1.6;
    margin: 0;
    padding: 0;
    background-color: #f5f5f5;
  }
  main{
    max-width: 800px;
    margin: 2rem auto;
    padding: 1.5rem;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  h1{
    color: #0f172a;
  }
  p{
    color: #333;
  }
</style>
</head>
<body>
  <main>
    <h1>√Ä propos de notre entreprise CHIFAI - TECH</h1>
    <p>
      Notre soci√©t√© informatique est sp√©cialis√©e dans la fourniture de prestations sur mesure pour accompagner
      les particuliers, PME et grandes entreprises dans leurs besoins technologiques. Nous proposons un large
      √©ventail de services allant de la maintenance et l‚Äôoptimisation de syst√®mes informatiques, √† la mise en
      place de r√©seaux s√©curis√©s, en passant par le d√©veloppement d‚Äôapplications personnalis√©es. Gr√¢ce √† notre
      √©quipe d‚Äôexperts passionn√©s et √† l‚Äô√©coute, nous garantissons des solutions performantes, fiables et
      adapt√©es aux objectifs de chaque client.
    </p>
  </main>
</body>
</html>

</body>
</html>
